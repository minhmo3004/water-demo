<div class="dashboard-container">
  <!-- Statistics Cards -->
  <div class="stats-row">
    <div class="stat-card anomaly-card">
      <div class="stat-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <div class="stat-content">
        <div class="stat-title">Bất thường được phát hiện</div>
        <div class="stat-number">{{ totalAnomalies() }}</div>
        <div class="stat-label">bất thường</div>
      </div>
    </div>

    <div class="stat-card verified-card">
      <div class="stat-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-content">
        <div class="stat-title">Bất thường được xác nhận</div>
        <div class="stat-number">{{ totalVerifiedAnomalies() }}</div>
        <div class="stat-label">xác nhận</div>
      </div>
    </div>
  </div>

  <!-- Main Content Section -->
  <div class="main-content-section">
    <!-- Data Table Section (40%) -->
    <div class="table-section">
      <div class="table-header">
        <div class="header-title-row">
          <h3 class="table-title">Dữ liệu đồng hồ trạm cấp nước</h3>
        </div>
        
        
        <div class="search-container">
            <div class="search-box">
              <i class="fas fa-search search-icon"></i>
              <input
                type="text"
                placeholder="Search"
                (input)="onSearchChange($event)"
                class="search-input"
              />
            </div>
        </div>
        
      </div>

      <div class="table-wrapper">
        <div class="table-header-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Tên trạm</th>
                <th>Address</th>
                <th>Trạng thái</th>
              </tr>
            </thead>
          </table>
        </div>
        <div class="table-body-container">
          <table class="data-table">
            <tbody>
              <tr *ngFor="let item of filteredData(); trackBy: trackByFn">
                <td class="station-name">
                  <span class="station-text">
                    {{ item.meter_data.name }}
                  </span>
                </td>
                <td class="address">{{ item.meter_data.address }}</td>
                <td>
                  <span [class]="'status-badge ' + getStatusClass(item.meter_data.status)">
                    {{ getStatusText(item.meter_data.status) }}
                  </span>
                </td>
              </tr>
              <tr *ngIf="filteredData().length === 0">
                <td colspan="3" class="no-data">Không có dữ liệu</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Van Dau 8 Detail Section (60%) -->
    <div class="detail-section">
      <div class="detail-header">
        <!-- Title Row -->
        <div class="header-title-row">
          <h3 class="detail-title">Văn Đẩu 8</h3>
        </div>
        
        <!-- Tabs Row -->
        <div class="header-tabs-row">
          <div class="header-tabs">
            <button 
              class="header-tab-button" 
              [class.active]="isActiveTab('general')"
              (click)="switchChartTab('general')">
              Tổng quát
            </button>
            <button 
              class="header-tab-button" 
              [class.active]="isActiveTab('anomaly')"
              (click)="switchChartTab('anomaly')">
              Hiển thị bất thường
            </button>
            <button 
              class="header-tab-button" 
              [class.active]="isActiveTab('anomaly-ai')"
              (click)="switchChartTab('anomaly-ai')">
              Hiển thị bất thường - AI
            </button>
          </div>
        </div>
      </div>

      <div class="detail-content">
        <!-- Chart Section -->
        <div class="chart-section">
          
          <!-- Chart Content -->
          <div class="chart-content">
            <!-- Chart Header Info -->
            <div class="chart-header-info">
              <h4 class="chart-main-title">{{ currentChartData().title }}</h4>
              <p class="chart-subtitle">{{ currentChartData().subtitle }}</p>
            </div>
            
            <!-- Professional Chart -->
            <div class="chart-wrapper">
              <div class="chart-container-with-grid">
                <svg viewBox="0 0 900 350" class="flow-chart" preserveAspectRatio="xMidYMid meet">
                  <!-- Background -->
                  <rect width="100%" height="100%" fill="white"/>
                  
                  <!-- Chart border -->
                  <rect x="70" y="30" width="800" height="280" fill="none" stroke="#e0e0e0" stroke-width="1"/>
                  
                  <!-- Horizontal grid lines -->
                  <g stroke="#f0f0f0" stroke-width="1">
                    <line x1="70" y1="310" x2="870" y2="310"/>
                    <line x1="70" y1="240" x2="870" y2="240"/>
                    <line x1="70" y1="170" x2="870" y2="170"/>
                    <line x1="70" y1="100" x2="870" y2="100"/>
                    <line x1="70" y1="30" x2="870" y2="30"/>
                  </g>
                  
                  <!-- Vertical grid lines -->
                  <g stroke="#f0f0f0" stroke-width="1">
                    <line x1="70" y1="30" x2="70" y2="310"/>
                    <line x1="185" y1="30" x2="185" y2="310"/>
                    <line x1="300" y1="30" x2="300" y2="310"/>
                    <line x1="415" y1="30" x2="415" y2="310"/>
                    <line x1="530" y1="30" x2="530" y2="310"/>
                    <line x1="645" y1="30" x2="645" y2="310"/>
                    <line x1="760" y1="30" x2="760" y2="310"/>
                    <line x1="870" y1="30" x2="870" y2="310"/>
                  </g>
                  
                  <!-- Y-axis labels inside SVG -->
                  <g fill="#666" font-size="11" font-family="Arial, sans-serif">
                    <text x="60" y="315" text-anchor="end">0</text>
                    <text x="60" y="245" text-anchor="end">10</text>
                    <text x="60" y="175" text-anchor="end">20</text>
                    <text x="60" y="105" text-anchor="end">30</text>
                    <text x="60" y="35" text-anchor="end">40</text>
                  </g>

                  <!-- Legend inside chart -->
                  <g class="chart-legend-group">
                    <!-- Legend background -->
                    <rect x="90" y="45" width="200" height="50" fill="white" stroke="#e0e0e0" stroke-width="1" rx="4"/>
                    
                    <!-- Original Flow legend -->
                    <line x1="100" y1="60" x2="120" y2="60" [attr.stroke]="currentChartData().legend[0].color" stroke-width="3"/>
                    <text x="125" y="64" fill="#333" font-size="12" font-family="Arial, sans-serif">{{ currentChartData().legend[0].label }}</text>
                    
                    <!-- Reconstructed Flow legend -->
                    <line x1="100" y1="80" x2="120" y2="80" [attr.stroke]="currentChartData().legend[1].color" stroke-width="3"/>
                    <text x="125" y="84" fill="#333" font-size="12" font-family="Arial, sans-serif">{{ currentChartData().legend[1].label }}</text>
                  </g>
                  
                  <!-- First line (dynamic color) -->
                  <polyline 
                    fill="none" 
                    [attr.stroke]="currentChartData().legend[0].color" 
                    stroke-width="2.5" 
                    points="100,200 140,180 180,240 220,210 260,160 300,230 340,190 380,140 420,250 460,180 500,120 540,220 580,160 620,100 660,200 700,150 740,90 780,190 820,130 860,70"/>
                  
                  <!-- Second line (dynamic color) -->
                  <polyline 
                    fill="none" 
                    [attr.stroke]="currentChartData().legend[1].color" 
                    stroke-width="2.5" 
                    points="100,210 140,190 180,250 220,220 260,170 300,240 340,200 380,150 420,260 460,190 500,130 540,230 580,170 620,110 660,210 700,160 740,100 780,200 820,140 860,80"/>
                    
                  <!-- Data points for better visualization -->
                  <g [attr.fill]="currentChartData().legend[0].color">
                    <circle cx="100" cy="200" r="3"/>
                    <circle cx="180" cy="240" r="3"/>
                    <circle cx="260" cy="160" r="3"/>
                    <circle cx="340" cy="190" r="3"/>
                    <circle cx="420" cy="250" r="3"/>
                    <circle cx="500" cy="120" r="3"/>
                    <circle cx="580" cy="160" r="3"/>
                    <circle cx="660" cy="200" r="3"/>
                    <circle cx="740" cy="90" r="3"/>
                    <circle cx="820" cy="130" r="3"/>
                  </g>
                  
                  <g [attr.fill]="currentChartData().legend[1].color">
                    <circle cx="100" cy="210" r="3"/>
                    <circle cx="180" cy="250" r="3"/>
                    <circle cx="260" cy="170" r="3"/>
                    <circle cx="340" cy="200" r="3"/>
                    <circle cx="420" cy="260" r="3"/>
                    <circle cx="500" cy="130" r="3"/>
                    <circle cx="580" cy="170" r="3"/>
                    <circle cx="660" cy="210" r="3"/>
                    <circle cx="740" cy="100" r="3"/>
                    <circle cx="820" cy="140" r="3"/>
                  </g>
                </svg>
              </div>
              
              <!-- X-axis labels -->
              <div class="chart-x-axis">
                <span class="x-axis-label">2024-04-17</span>
                <span class="x-axis-label">2024-04-25</span>
                <span class="x-axis-label">2024-05-03</span>
                <span class="x-axis-label">2024-05-11</span>
                <span class="x-axis-label">2024-05-19</span>
                <span class="x-axis-label">2024-05-27</span>
                <span class="x-axis-label">2024-06-01</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
